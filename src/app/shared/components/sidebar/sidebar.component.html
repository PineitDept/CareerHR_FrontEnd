<nav [style.width]="sidebarWidth"
  class="tw-h-full tw-bg-[#121212] tw-text-white tw-flex tw-flex-col tw-justify-between tw-py-4 text-xs tw-overflow-hidden tw-transition-[width] tw-duration-300 tw-ease-in-out relative">
  <!-- Toggle and Back -->
  <div class="tw-flex tw-gap-x-2 tw-px-4 tw-h-10">
    <div class="tw-cursor-pointer hover:tw-text-[#AA0000]" (click)="toggleSidebar()">
      <app-icon name="dashboard-square" [size]="24" />
    </div>
    <div *ngIf="(activeMainMenu && isExpanded) || adminSettingSubMenu" class="tw-cursor-pointer hover:tw-text-[#AA0000]"
      (click)="adminSettingSubMenu ? backToSubMenu() : backToMainMenu()">
      <app-icon name="chevron-left" [size]="20" />
    </div>
  </div>

  <!-- Menu Area: Main & Sub menu switch -->
  <div class="tw-relative tw-flex-1 tw-mt-3">
    <!-- Main Menu -->
    <ul *ngIf="!activeMainMenu && !adminSettingSubMenu"
      class="tw-absolute tw-top-0 tw-left-0 tw-w-full tw-transition-all tw-duration-300 tw-space-y-6 tw-px-4">
      <li *ngFor="let item of mainMenu"
        class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000]"
        [ngClass]="{ 'tw-text-[#AA0000]': item.label === activeMainMenu && adminSettingSubMenu === '' }"
        (click)="onMainMenuClick(item.label)">
        <app-icon [name]="item.icon" [size]="20" />
        <span [class]="menuLabelClass">{{ item.label }}</span>
      </li>
    </ul>

    <!-- Submenus -->
    <!-- General submenu -->
    <ng-container *ngIf="activeMainMenu && activeMainMenu !== 'Admin Setting'">
      <ul class="tw-absolute tw-top-0 tw-left-0 tw-w-full tw-transition-all tw-duration-300 tw-space-y-4 tw-px-4">
        <li *ngFor="let item of subMenus[activeMainMenu]">
          <div class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000]"
            [ngClass]="{ 'tw-text-[#AA0000]': isRouteActive(item.path ?? '') }"
            (click)="item.children ? toggleNested(item.label) : navigateToSubPagePath(item.path!)">
            <app-icon [name]="item.icon" [size]="20" />
            <span [class]="menuLabelClass">{{ item.label }}</span>
          </div>
          <div *ngIf="item.children && expandedNestedMenus.has(item.label)"
            class="tw-bg-[#1E1E1E] tw-rounded-sm tw-border-l-[4px] tw-border-[#AA0000] tw-mt-1">
            <ul class="tw-space-y-1 tw-py-2">
              <li *ngFor="let child of item.children"
                class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000] tw-pl-6 tw-pr-4 tw-py-1"
                [ngClass]="{ 'tw-text-[#AA0000]': isRouteActive(child.path ?? '') }"
                (click)="navigateToSubPagePath(child.path!)">
                <app-icon [name]="child.icon" [size]="16" />
                <span [class]="menuLabelClass">{{ child.label }}</span>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </ng-container>

    <!-- Admin Setting submenu level 1 -->
    <ng-container *ngIf="activeMainMenu === 'Admin Setting' && !adminSettingSubMenu">
      <ul class="tw-absolute tw-top-0 tw-left-0 tw-w-full tw-transition-all tw-duration-300 tw-space-y-4 tw-px-4">
        <li *ngFor="let item of subMenus['Admin Setting']">
          <div class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000]"
            [ngClass]="{ 'tw-text-[#AA0000]': expandedNestedMenus.has(item.label) || item.label === adminSettingSubMenu }"
            (click)="item.label === 'Data Setting' ? adminSettingSubMenu = 'Data Setting' : toggleNested(item.label)">
            <app-icon [name]="item.icon" [size]="20" />
            <span [class]="menuLabelClass">{{ item.label }}</span>
          </div>
          <!-- Handle Permissions and Data Setting submenu expand separately -->
          <div *ngIf="item.label === 'Permissions' && item.children && expandedNestedMenus.has(item.label)"
            class="tw-bg-[#1E1E1E] tw-rounded-sm tw-border-l-[4px] tw-border-[#AA0000] tw-mt-1">
            <ul class="tw-space-y-1 tw-py-2">
              <li *ngFor="let child of item.children"
                class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000] tw-pl-6 tw-pr-4 tw-py-1"
                [ngClass]="{ 'tw-text-[#AA0000]': isRouteActive(child.path ?? '') }"
                (click)="navigateToSubPagePath(child.path!)">
                <app-icon [name]="child.icon" [size]="16" />
                <span [class]="menuLabelClass">{{ child.label }}</span>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </ng-container>

    <!-- Admin Setting: Data Setting submenu -->
    <ng-container *ngIf="adminSettingSubMenu === 'Data Setting' && !dataSettingSubMenu">
      <ul class="tw-absolute tw-top-0 tw-left-0 tw-w-full tw-transition-all tw-duration-300 tw-space-y-4 tw-px-4">
        <li *ngFor="let group of dataSettingChildren">
          <div class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000]"
            [ngClass]="{ 'tw-text-[#AA0000]': expandedNestedMenus.has(group.label) }"
            (click)="toggleNested(group.label)">
            <app-icon [name]="group.icon" [size]="20" />
            <span [class]="menuLabelClass">{{ group.label }}</span>
          </div>
          <div *ngIf="group.children && expandedNestedMenus.has(group.label)"
            class="tw-bg-[#1E1E1E] tw-rounded-sm tw-border-l-[4px] tw-border-[#AA0000] tw-mt-1">
            <ul class="tw-space-y-1 tw-py-2">
              <li *ngFor="let item of group.children"
                class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000] tw-pl-6 tw-pr-4 tw-py-1"
                [ngClass]="{ 'tw-text-[#AA0000]': isRouteActive(item.path ?? '') }"
                (click)="navigateToSubPagePath(item.path!)">
                <app-icon [name]="item.icon" [size]="16" />
                <span [class]="menuLabelClass">{{ item.label }}</span>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </ng-container>

    <!-- Admin Setting: Application submenu -->
    <ng-container *ngIf="dataSettingSubMenu === 'Application'">
      <ul class="tw-absolute tw-top-0 tw-left-0 tw-w-full tw-transition-all tw-duration-300 tw-space-y-4 tw-px-4">
        <li *ngFor="let group of applicationSettingChildren">
          <div class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000]"
            [ngClass]="{ 'tw-text-[#AA0000]': expandedNestedMenus.has(group.label) }"
            (click)="toggleNested(group.label)">
            <app-icon [name]="group.icon" [size]="20" />
            <span [class]="menuLabelClass">{{ group.label }}</span>
          </div>
          <div *ngIf="group.children && expandedNestedMenus.has(group.label)"
            class="tw-bg-[#1E1E1E] tw-rounded-sm tw-border-l-[4px] tw-border-[#AA0000] tw-mt-1">
            <ul class="tw-space-y-1 tw-py-2">
              <li *ngFor="let item of group.children"
                class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000] tw-pl-6 tw-pr-4 tw-py-1"
                [ngClass]="{ 'tw-text-[#AA0000]': isRouteActive(item.path ?? '') }"
                (click)="navigateToSubPagePath(item.path!)">
                <app-icon [name]="item.icon" [size]="16" />
                <span [class]="menuLabelClass">{{ item.label }}</span>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </ng-container>
  </div>

  <!-- Bottom Menu -->
  <ul class="tw-space-y-6 tw-px-4 tw-mt-6">
    <ng-container *ngFor="let item of bottomMenu">
      <li *ngIf="!(activeMainMenu === 'Admin Setting' || adminSettingSubMenu) || item.label !== 'Admin Setting'"
        class="tw-flex tw-items-center tw-gap-x-2 tw-cursor-pointer hover:tw-text-[#AA0000]"
        (click)="item.label === 'Logout' ? logout() : onMainMenuClick(item.label)">
        <app-icon [name]="item.icon" [size]="20" />
        <span [class]="menuLabelClass">{{ item.label }}</span>
      </li>
    </ng-container>
  </ul>
</nav>
