<div class="tw-flex tw-justify-center tw-gap-4 tw-overflow-x-auto tw-scrollbar-hide tw-py-4 tw-px-2">
  @for (group of items; track group.groupKey) {
  <div class=" tw-w-[240px] tw-group">
    <!-- Card Container -->
    <div class="tw-bg-white tw-rounded-lg tw-shadow-sm tw-border tw-h-full tw-border-gray-200 
                  tw-transition-all tw-duration-300 tw-ease-out
                  hover:tw-shadow-md hover:tw--translate-y-0.5">

      <!-- Header -->
      <div class="tw-relative tw-overflow-hidden tw-rounded-t-lg tw-bg-white tw-border-b tw-border-gray-100">
        <div class="tw-flex tw-justify-between tw-items-center tw-p-4 tw-cursor-pointer
                      tw-transition-all tw-duration-200 hover:tw-bg-gray-50" (click)="toggleGroup(group.groupKey)">

          <div class="tw-flex tw-items-center tw-gap-3">
            <h3 class="tw-font-bold tw-text-gray-900 tw-text-sm tw-leading-tight">
              {{ group.groupLabel }}
            </h3>
              <!-- Badge for selected count -->
              @if (getCheckedCount(group.groupKey) > 0) {
                <span class="tw-inline-flex tw-items-center tw-px-2.5 tw-py-1 tw-rounded-full 
                           tw-text-xs tw-font-semibold bg-azure tw-text-white
                           tw-animate-pulse">
                  {{ getCheckedCount(group.groupKey) }}
                </span>
              }
          </div>

          <!-- Toggle Icon -->
          <div class="tw-flex tw-items-center tw-justify-center tw-w-5 tw-h-5 
                        tw-transition-transform tw-duration-300 tw-ease-out
                        tw-text-gray-500" [class.tw-rotate-180]="isExpanded(group.groupKey)">
            <app-icon name="chevron-down" [size]="16" fill="currentColor">
            </app-icon>
          </div>
        </div>
      </div>

      <!-- Content Area -->
      <div class="tw-overflow-hidden tw-transition-all tw-duration-300 tw-ease-out"
        [class.tw-max-h-0]="!isExpanded(group.groupKey)" [class.tw-max-h-96]="isExpanded(group.groupKey)">
        @if (isExpanded(group.groupKey)) {
        <div class="tw-p-3 tw-space-y-1 tw-animate-in tw-slide-in-from-top-2 tw-fade-in tw-duration-300">
          @for (option of group.options; track option.key; let i = $index) {
          <label class="tw-group/option tw-flex tw-items-center tw-gap-3 tw-cursor-pointer 
                           tw-p-2 tw-rounded-md tw-transition-all tw-duration-200 tw-ease-out
                           hover:tw-bg-gray-50" [style.animation-delay]="i * 30 + 'ms'">

            <!-- Custom Checkbox -->
            <div class="tw-relative tw-flex tw-items-center">
              <input type="checkbox" class="tw-sr-only tw-peer" [checked]="isChecked(group.groupKey, option.key)"
                (change)="toggleOption(group.groupKey, option.key)" />

              <!-- Checkbox Visual -->
              <div class="tw-w-4 tw-h-4 tw-border tw-border-gray-300 tw-rounded 
                               tw-transition-all tw-duration-200 tw-ease-out
                               tw-peer-checked:bg-azure tw-peer-checked:tw-border-azure
                               tw-peer-checked:tw-scale-105
                               group-hover/option:tw-border-azure
                               tw-peer-focus:tw-ring-2 tw-peer-focus:tw-ring-azure tw-peer-focus:tw-ring-offset-2">

                <div class="tw-w-3 tw-h-3 bg-azure tw-absolute tw-top-0.5 tw-left-0.5
                                 tw-rounded 
                                 tw-transition-all tw-duration-200 tw-ease-out"
                  [class.tw-opacity-100]="isChecked(group.groupKey, option.key)"
                  [class.tw-scale-100]="isChecked(group.groupKey, option.key)"
                  [class.tw-opacity-0]="!isChecked(group.groupKey, option.key)"
                  [class.tw-scale-0]="!isChecked(group.groupKey, option.key)"></div>
              </div>
            </div>

            <!-- Label -->
            <span class="tw-text-sm tw-font-normal tw-leading-relaxed 
         tw-transition-colors tw-duration-200" [class.text-azure]="isChecked(group.groupKey, option.key)"
              [class.tw-font-medium]="isChecked(group.groupKey, option.key)"
              [class.tw-text-gray-700]="!isChecked(group.groupKey, option.key)"
              [class.group-hover\:tw-text-gray-900]="!isChecked(group.groupKey, option.key)">
              {{ option.label }}
            </span>

          </label>
          } @empty {
          <div class="tw-flex tw-flex-col tw-items-center tw-justify-center tw-py-6 tw-text-center">
            <div class="tw-w-8 tw-h-8 tw-bg-gray-100 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mb-2">
              <svg class="tw-w-4 tw-h-4 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2M4 13h2" />
              </svg>
            </div>
            <p class="tw-text-gray-500 tw-text-xs tw-font-medium">ไม่มีตัวเลือก</p>
          </div>
          }
        </div>
        }
      </div>
    </div>
  </div>
  } @empty {
  <div class="tw-flex tw-flex-col tw-items-center tw-justify-center tw-w-full tw-py-16 tw-text-center">
    <div class="tw-w-20 tw-h-20 tw-bg-gray-100 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mb-4">
      <svg class="tw-w-10 tw-h-10 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
      </svg>
    </div>
    <h3 class="tw-text-gray-600 tw-text-lg tw-font-semibold tw-mb-2">ไม่มีตัวกรอง</h3>
    <p class="tw-text-gray-500 tw-text-sm">ยังไม่มีตัวเลือกการกรองที่พร้อมใช้งาน</p>
  </div>
  }
</div>