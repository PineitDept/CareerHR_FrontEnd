<div class="tw-flex tw-flex-wrap tw-items-center tw-gap-4 tw-px-6 tw-py-6 tw-bg-white" [ngClass]="!filterDate ? ' tw-justify-end' : 'tw-justify-between'">

  <!-- Left Section -->
  <div class="tw-flex tw-gap-4" [ngClass]="filterDate ? 'tw-block' : 'tw-hidden'">

    <!-- Back Button -->
    <button
      *ngIf="filterDynamicButton && !GradeSelect"
      (click)="onBackClick()"
      class="tw-flex tw-items-center tw-gap-2 tw-bg-transparent tw-text-[#212529] tw-rounded-lg tw-px-2 tw-py-1 tw-text-base tw-font-semibold"
    >
      <app-icon name="chevron-left" [size]="16" />
      <span>Back</span>
    </button>

    <!-- Year Dropdown -->
    <div class="tw-relative dropdown tw-min-w-[135px]" #yearDropdown *ngIf="!filterDynamicButton && !disabledFilterDateRange && !GradeSelect">
      <button (click)="toggleDropdown('year')"
        class="tw-w-full tw-bg-black tw-text-white tw-rounded-lg tw-px-4 tw-py-2 tw-text-base tw-flex tw-items-center tw-justify-between tw-gap-2">
        {{ selectedYear }}
        <app-icon name="chevron-down" [size]="16" />
      </button>
      <ul *ngIf="isYearOpen"
        class="tw-absolute tw-bg-white tw-shadow-md tw-rounded-lg tw-mt-1 tw-z-20 tw-w-full tw-min-w-[100px]">
        <li *ngFor="let y of years" (click)="selectOption('year', y)"
          class="tw-px-4 tw-py-2 tw-text-base tw-cursor-pointer hover:tw-bg-gray-100">
          {{ y }}
        </li>
      </ul>
    </div>

    <!-- Month Dropdown -->
    <div class="tw-relative dropdow tw-min-w-[135px]" #monthDropdown *ngIf="!filterDynamicButton && !disabledFilterDateRange && !GradeSelect">
      <button (click)="toggleDropdown('month')"
        class="tw-w-full tw-bg-black tw-text-white tw-rounded-lg tw-px-4 tw-py-2 tw-text-base tw-flex tw-items-center tw-justify-between tw-gap-2">
        {{ selectedMonth }}
        <app-icon name="chevron-down" [size]="16" />
      </button>
      <ul *ngIf="isMonthOpen"
        class="tw-absolute tw-bg-white tw-shadow-md tw-rounded-lg tw-mt-1 tw-z-20 tw-w-full tw-min-w-[100px]">
        <li *ngFor="let m of months" (click)="selectOption('month', m)"
          class="tw-px-4 tw-py-2 tw-text-base tw-cursor-pointer hover:tw-bg-gray-100">
          {{ m }}
        </li>
      </ul>
    </div>

    <!-- Grade Dropdown -->
    <div class="tw-relative dropdow tw-min-w-[135px]" #gradeDropdown *ngIf="!filterDynamicButton && GradeSelect">
      <button (click)="toggleDropdown('grade')"
        class="tw-w-full tw-bg-black tw-text-white tw-rounded-lg tw-px-4 tw-py-2 tw-text-base tw-flex tw-items-center tw-justify-between tw-gap-2">
        {{ selectedGrade }}
        <app-icon name="chevron-down" [size]="16" />
      </button>
      <ul *ngIf="isGradeOpen"
        class="tw-absolute tw-bg-white tw-shadow-md tw-rounded-lg tw-mt-1 tw-z-20 tw-w-full tw-min-w-[100px]">
        <li *ngFor="let g of allGrade" (click)="selectOption('grade', g)"
          class="tw-px-4 tw-py-2 tw-text-base tw-cursor-pointer hover:tw-bg-gray-100">
          {{ g }}
        </li>
      </ul>
    </div>

    <!-- All List Button -->
    <button
      class="tw-bg-[#660708] tw-text-white tw-rounded-lg tw-px-4 tw-py-2 tw-text-base tw-min-w-[112px]"
      (click)="onAllListClick()"
      *ngIf="!filterDynamicButton && !disabledFilterDateRange && !GradeSelect && !DateCalendar"
    >
      All List
    </button>

    <!-- All List Button -->
    <button
      class="tw-bg-[#660708] tw-text-white tw-rounded-lg tw-px-4 tw-py-2 tw-text-base tw-min-w-[112px]"
      (click)="onClickToday()"
      *ngIf="DateCalendar"
    >
      Today
    </button>
  </div>

  <!-- Right Section -->
  <div class="tw-flex tw-gap-4">

    <!-- Company Toggle Buttons -->
    <div class="tw-flex" *ngIf="!filterDynamicButton && filterOurCompany">
      <ng-container *ngFor="let company of ourCompany">
        <button
          [ngClass]="{
            'tw-bg-[#660708] !tw-text-white': selectedCompany === company,
            'tw-bg-[#930000] tw-text-white': selectedCompany !== company
          }"
          class="tw-px-4 tw-py-2 tw-text-base"
          (click)="selectOption('company', company)"
        >
          {{ company }}
        </button>
      </ng-container>
    </div>

    <!-- Dynamic Buttons -->
    <ng-container *ngFor="let btn of actionButtons">
      <!-- ปุ่มแบบ Select (มี options) -->
      <div class="tw-relative tw-min-w-[120px]" *ngIf="btn.options?.length; else normalBtn">
        <button
          (click)="toggleActionDropdown(btn.key, $event)"
          class="btn-dynamic tw-rounded-lg tw-px-4 tw-py-2 tw-text-base tw-w-full tw-inline-flex tw-items-center tw-justify-between"
          [style.--btn-bg]="btn.color || '#0A84FF'"
          [style.--btn-ring]="btn.borderColor || btn.color || '#0A84FF'"
          [style.color]="btn.textColor || (isWhite(btn.color) ? '#111827' : '#FFFFFF')"
          [class.tw-border]="isWhite(btn.color) || btn.outlineBtn || !!btn.borderColor"
          [style.borderColor]="btn.borderColor || (isWhite(btn.color) ? '#D1D5DB' : 'transparent')"
          [ngClass]="btn.outlineBtn
            ? '!tw-bg-transparent tw-border tw-border-black !tw-text-black tw-font-bold hover:!tw-bg-black hover:!tw-text-white'
            : ''"
        >
          <span>{{ btn.label }}</span>
          <app-icon name="chevron-down" [size]="16"></app-icon>
        </button>

        <ul
          *ngIf="openActionKey === btn.key"
          class="tw-absolute tw-right-0 tw-bg-white tw-shadow-md tw-rounded-lg tw-mt-1 tw-z-20 tw-w-full tw-min-w-[140px]"
        >
          <li
            *ngFor="let opt of btn.options"
            (click)="selectActionOption(btn, opt, $event)"
            class="tw-px-4 tw-py-2 tw-text-base tw-cursor-pointer hover:tw-bg-gray-100"
          >
            {{ opt.label }}
          </li>
        </ul>
      </div>

      <!-- ปุ่มแบบปกติ -->
      <ng-template #normalBtn>
        <button
          class="btn-dynamic tw-rounded-lg tw-px-4 tw-py-2 tw-text-base
                disabled:tw-opacity-50 disabled:tw-cursor-not-allowed tw-min-w-[120px]"
          [style.--btn-bg]="btn.color || '#0A84FF'"
          [style.--btn-ring]="btn.borderColor || btn.color || '#0A84FF'"
          [style.color]="btn.textColor || (isWhite(btn.color) ? '#111827' : '#FFFFFF')"
          [class.tw-border]="isWhite(btn.color) || btn.outlineBtn || !!btn.borderColor"
          [style.borderColor]="btn.borderColor || (isWhite(btn.color) ? '#D1D5DB' : 'transparent')"
          (click)="onActionButtonClick(btn.key)"
          [disabled]="disabledKeys.includes(btn.key) || ((btn.key === 'submit' || btn.key === 'register') && (!(selectedRows.length)))"
        >
          {{ btn.label }}
        </button>
      </ng-template>

    </ng-container>
  </div>
</div>
