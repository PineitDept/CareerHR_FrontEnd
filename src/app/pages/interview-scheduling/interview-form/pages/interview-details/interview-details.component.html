<!-- sentinel สำหรับ back-to-top -->
<div id="page-top-sentinel" class="tw-h-px tw-w-px tw-opacity-0" aria-hidden="true"></div>

<div class="tw-sticky tw-top-0 tw-z-[30] tw-bg-white">
    <app-header-content [headerName]="'Interview Details'" [headerType]="''"></app-header-content>
</div>

<app-filter [filterDynamicButton]="true" [ButtonBackSave]="true" [actionButtons]="filterButtons" (buttonClicked)="onFilterButtonClick($event)"
    [disabledKeys]="disabledKeys"></app-filter>

<app-loading></app-loading>

<!-- ================= MAIN GRID ================= -->
<div class="tw-grid tw-grid-cols-4 tw-gap-6 tw-px-6 tw-py-6 tw-bg-white">
    <!-- =============== LEFT (2 cols) =============== -->
    <div class="tw-col-span-4 tw-space-y-6">
        <!-- ===== Applicant Header Card ===== -->
        <section
            class="tw-bg-white tw-rounded-xl tw-shadow-[0_6px_12px_rgba(0,0,0,0.3)] tw-flex tw-items-stretch overflow-hidden">
            <!-- Avatar -->
            <div
                class="tw-w-[20%] tw-shrink-0 tw-overflow-hidden tw-rounded-l-xl tw-flex tw-items-center tw-justify-center tw-bg-gray-100">
                <ng-container *ngIf="applicant.avatarUrl; else noAvatar">
                    <img class="tw-w-full tw-h-full tw-object-cover" [src]="applicant.avatarUrl" alt="avatar" />
                </ng-container>
                <ng-template #noAvatar>
                    <app-icon name="user" [size]="81" class="tw-text-gray-400"></app-icon>
                </ng-template>
            </div>

            <!-- Info -->
            <div class="tw-flex-1 tw-space-y-2 tw-px-6 tw-py-4">
                <div class="tw-flex tw-items-center tw-justify-between">
                    <div>
                        <div
                            class="tw-inline-flex tw-items-center tw-gap-2 tw-text-[14px] tw-font-semibold tw-bg-[#DDF7F8] tw-text-[#29C6CF] tw-px-2 tw-py-1 tw-rounded-md">
                            Applied Date {{ applicant.appliedDate | date : "dd/MM/yyyy" }}
                        </div>
                    </div>
                </div>

                <div class="tw-text-[22px] tw-font-semibold">{{ applicant.name }}</div>

                <div class="tw-text-[14px] tw-font-medium tw-text-gray-800 tw-flex tw-flex-wrap">
                    <!-- university -->
                    <span *ngIf="applicant.university as u">{{ u }}</span>

                    <!-- faculty -->
                    <span
                        *ngIf="applicant.university && applicant.faculty"
                        class="tw-mx-2 tw-text-gray-400"
                        aria-hidden="true"
                    >|</span>
                    <span *ngIf="applicant.faculty">{{ applicant.faculty }}</span>

                    <!-- program -->
                    <span
                        *ngIf="(applicant.faculty || applicant.university) && applicant.program"
                        class="tw-mx-2 tw-text-gray-400"
                        aria-hidden="true"
                    >|</span>
                    <span *ngIf="applicant.program">{{ applicant.program }}</span>

                    <!-- graduation year -->
                    <span
                        *ngIf="(applicant.university || applicant.faculty || applicant.program) && applicant.graduation_year"
                        class="tw-mx-2 tw-text-gray-400"
                        aria-hidden="true"
                    >|</span>
                    <span *ngIf="applicant.graduation_year as y">{{ y }}</span>
                    </div>


                <div class="tw-text-[14px] !tw-mt-0">
                    <ng-container *ngIf="applicant.gpa as gpa">
                        <span class="tw-font-medium">GPA </span>
                        <span class="tw-font-medium">{{ gpa }}</span>
                    </ng-container>
                </div>

                <div class="tw-text-[14px] !tw-mt-0">
                    <ng-container *ngIf="applicant.age as age">
                        <span class="tw-font-medium">Age : </span>
                        <span class="tw-font-medium">{{ age }}</span>
                    </ng-container>
                </div>

                <div class="tw-space-y-2 tw-py-2 !tw-mb-2">
                    <div class="tw-text-[14px]">
                      <div class="tw-flex tw-items-center tw-gap-2 tw-font-semibold tw-text-[#0A57C3]">
                        <app-icon name="briefcase" [size]="20" class="tw-text-[#0A57C3]"></app-icon>
                        <span>Applied Position</span>
                      </div>

                      <div class="tw-mt-2 tw-flex tw-flex-col tw-gap-2">
                        <ng-container *ngIf="(applicant.positions?.length || 0) > 0; else noPositions">
                          <span
                            *ngFor="let pos of applicant.positions"
                            class="tw-self-start tw-inline-flex tw-items-center tw-gap-1.5 tw-px-2.5 tw-py-1
                                  tw-rounded-full tw-bg-[#E8F0FE] tw-text-[#0A57C3] tw-text-[13px] tw-font-medium
                                  tw-ring-1 tw-ring-[#BFD3FF]">
                            {{ pos }}
                          </span>
                        </ng-container>

                        <ng-template #noPositions>
                          <span class="tw-text-gray-500">—</span>
                        </ng-template>
                      </div>
                    </div>

                    <div class="tw-pt-2">
                        <div class="tw-text-[14px] tw-flex">
                            <div class="tw-text-gray-500 tw-font-medium">Email :</div>
                            <div class="tw-ml-1">{{ applicant.email }}</div>
                        </div>
                        <div class="tw-text-[14px] tw-flex">
                            <div class="tw-text-gray-500 tw-font-medium">Phone :</div>
                            <div class="tw-ml-1">{{ applicant.phone }}</div>
                        </div>
                    </div>
                </div>

                <hr class="tw--mx-0 !tw-mt-4" />

                <div class="tw-flex tw-items-center tw-justify-between tw-pt-3 tw-text-[14px] tw-text-gray-500">
                    <div class="tw-text-gray-500 tw-font-medium">
                        Applicant Grade {{ applicant.grade }}
                    </div>
                    <!-- Like / Unlike -->
                    <button type="button"
                        class="tw-inline-flex tw-items-center tw-gap-2 tw-rounded-md tw-px-2 tw-py-1 hover:tw-bg-gray-100 disabled:tw-opacity-60 disabled:tw-cursor-not-allowed"
                        [disabled]="likeState.loading || !applicantId" (click)="onToggleLike()"
                        [attr.aria-pressed]="likeState.liked" [title]="likeState.liked ? 'Unlike' : 'Like'">
                        <app-icon [name]="likeState.liked ? 'thumbs-up-solid' : 'thumbs-up'" [size]="18"
                            [ngClass]="likeState.liked ? 'tw-text-[#0A57C3]' : 'tw-text-inherit'"></app-icon>
                        <span>{{ applicant.views }}</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- ===== Interview Detail ===== -->
        <section class="tw-w-full">
            <form [formGroup]="formInterviewDetails">
                <div class="tw-bg-[#FFFFFF]">
                    <div class="tw-bg-white tw-px-6 tw-pt-4 tw-rounded-xl tw-shadow-[0_6px_12px_rgba(0,0,0,0.3)]">
                        <div class="tw-flex tw-items-center tw-justify-between tw-cursor-pointer"
                            (click)="isDetail1Open = !isDetail1Open">
                            <!-- <div class="tw-flex tw-items-center tw-justify-between"> -->
                            <label class="tw-text-lg tw-font-bold">Interview Detail 1</label>
                            <app-icon name="chevron-down" [size]="14"
                                [extraClass]="isDetail1Open ? 'tw-rotate-180 tw-transition-transform' : 'tw-transition-transform'"></app-icon>
                        </div>

                        <hr class="tw--mx-6 tw-mt-4" />

                        <ng-container *ngIf="isDetail1Open">
                            <div class="tw--mx-6 tw-rounded-b-xl tw-overflow-hidden" (input)="onAnyTextInput()" (change)="onAnyTextInput()">
                                <app-tables [rows]="detail1Rows" [columns]="detail1Columns" [showCheckbox]="false"
                                    [splitRows]="false" [hasOverflowY]="false" [enableRowClick]="false"
                                    [withinCard]="true" [preferIdForSelect]="true"
                                    (selectChanged)="onSelectChanged1($event)"
                                    (inlineFieldCommit)="onInlineFieldCommit1($event)">
                                </app-tables>
                            </div>
                        </ng-container>
                    </div>
                    <div
                        class="tw-bg-white tw-px-6 tw-pt-4 tw-rounded-xl tw-shadow-[0_6px_12px_rgba(0,0,0,0.3)] tw-mt-6">
                        <div class="tw-flex tw-items-center tw-justify-between tw-cursor-pointer"
                            (click)="isDetail2Open = !isDetail2Open">
                            <!-- <div class="tw-flex tw-items-center tw-justify-between"> -->
                            <label class="tw-text-lg tw-font-bold">Interview Detail 2</label>
                            <app-icon name="chevron-down" [size]="14"
                                [extraClass]="isDetail2Open ? 'tw-rotate-180 tw-transition-transform' : 'tw-transition-transform'"></app-icon>
                        </div>

                        <hr class="tw--mx-6 tw-mt-4" />

                        <ng-container *ngIf="isDetail2Open">
                            <div class="tw--mx-6 tw-rounded-b-xl tw-overflow-hidden" (input)="onAnyTextInput()" (change)="onAnyTextInput()">
                                <app-tables [rows]="detail2Rows" [columns]="detail2Columns" [showCheckbox]="false"
                                    [splitRows]="false" [hasOverflowY]="false" [enableRowClick]="false"
                                    [withinCard]="true" [preferIdForSelect]="true"
                                    (selectChanged)="onSelectChanged2($event)"
                                    (inlineFieldCommit)="onInlineFieldCommit2($event)">
                                </app-tables>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </form>
        </section>

    </div>
</div>

<!-- Floating Back-to-Top -->
<app-back-to-top
  [sentinelSelector]="'#page-top-sentinel'"
  [buttonClass]="'tw-fixed tw-bottom-6 tw-right-6 tw-rounded-full tw-h-14 tw-w-14 tw-flex tw-items-center tw-justify-center tw-shadow-xl bg-red-blood hover:bg-maroon-1 tw-text-white tw-z-[60]'"
  [iconName]="'arrow-upward'"
  [iconSize]="26">
</app-back-to-top>
